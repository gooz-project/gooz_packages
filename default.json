{
    "name": "mpu6050",
    "codes": [
        {
            "filename": "main.py",
            "code": "from machine import Pin,SoftI2C,RTCpkglineflagfrom wifuxlogger import WifuxLogger as LOGpkglineflagfrom engine.engine_template import EngineTemplatepkglineflagimport ujsonpkglineflagfrom dev.pin.core import CommonCommands as PinCommandspkglineflagfrom dev.tool.gooz_thread import _gooz_start_function_threadpkglineflagfrom app.mpu6050.mpu6050 import accelpkglineflagpkglineflagconfig_path=\"//app/mpu6050/mpu6050config.json\"pkglineflagpkglineflagclass MPU6050Usage():pkglineflag    def error_undefined_pin(pin_name):pkglineflag        LOG.error(f'There is no MPU6050 pin named \"{pin_name}\" !')pkglineflag    def var_usage():pkglineflag        LOG.info('\\nUsage:\\n->mpu6050 var --name [PIN_NAME] --scl [SCL_PIN] --sda [SDA_PIN]')pkglineflag    def read_usage():pkglineflag        LOG.info('\\nUsage:\\n->mpu6050 read [PIN_NAME] --gyro x,y,z --acceleration x,y,z --temperature [STATUS]')pkglineflag        LOG.info('If temperature is desired to be measured [STATUS] should be \"on\",otherwise --temperature does not need to be entered.')pkglineflag        LOG.info('Only the parameters that are desirable to be measured should be entered.For example, if the x direction of gyro is desired to be measured,\"--gyro x\" is enough.')pkglineflag    def listen_usage():pkglineflag        LOG.info('\\nUsage:\\n->mpu6050 listen [PIN_NAME] --gyro x,y,z --acceleration x,y,z --temperature [STATUS] --loop [MEASURING_LOOP] --delay [SLEEP_TIME] --file [FILE_NAME]')pkglineflag        LOG.info('If temperature is desired to be measured [STATUS] should be \"on\",otherwise --temperature does not need to be entered.')pkglineflag        LOG.info('Only the parameters that are desirable to be measured should be entered.')pkglineflag        LOG.info('If [FILE_NAME] is empty, it will not be saved')pkglineflag        LOG.info('[SLEEP_TIME] is not necessary! Default value: 1 second')pkglineflag        LOG.info('[MEASURING_LOOP] is not necessary! If not entered, loop lasts until \"thread stop [THREAD_ID]\" command')pkglineflag        LOG.info('[THREAD_ID] is seen with \"thread show\" command')pkglineflag    def delete_usage():pkglineflag        LOG.info('Usage -> mpu6050 delete [PIN_NAME]')pkglineflag        LOG.info('deletes registered mpu6050 pin named [PIN_NAME]')pkglineflag        LOG.info('To delete all registered mpu6050 pins -> mpu6050 delete all')pkglineflag    def update_usage():pkglineflag        LOG.info('Usage -> mpu6050 update [PIN_NAME] --[VALUE_TO_CHANGE] [NEW_VALUE]')pkglineflag        LOG.info('updates the [VALUE_TO_CHANGE] value of the mpu6050 pin named [PIN_NAME] to [NEW_VALUE]')pkglineflag    def show_usage():pkglineflag        LOG.info('Usage -> mpu6050 show')pkglineflag        LOG.info('shows all registered mpu6050 pins')pkglineflag        LOG.info('Usage -> mpu6050 show [PARAMETER]:[VALUE_TO_SEARCH_FOR]')pkglineflag        LOG.info('shows specific mpu6050 pins')pkglineflagpkglineflagdef help(cmds):pkglineflag    command_list = ['var','show','delete','update','read','listen']pkglineflag    if not len(cmds) > 2:pkglineflag        print('Commands: ')pkglineflag        for command in command_list:pkglineflag            print(command)pkglineflag        LOG.info('For more information about commands -> mpu6050 help [COMMAND]')pkglineflag        return 'OK!'pkglineflag    try:pkglineflag        exec(f'MPU6050Usage.{cmds[2]}_usage()')pkglineflag    except:pkglineflag        LOG.error(f'There is no help for \"{cmds[2]}\"!')pkglineflagpkglineflagpkglineflagdef var(cmds):pkglineflag    blueprint={\"pinType\":\"mpu6050\",\"--name\":\"\",\"--scl\":\"\",\"--sda\":\"\"}pkglineflag    missing_arg = Falsepkglineflag    temp = EngineTemplate.parameter_parser(cmds,blueprint)pkglineflag    for key in temp:pkglineflag        if temp[key] == \"\":pkglineflag            LOG.error('Error while registering MPU6050 pin!')pkglineflag            LOG.error('Missing Argument(s)!')pkglineflag            missing_arg = Truepkglineflag            breakpkglineflag    if missing_arg:pkglineflag        return 'Missing arg(s)!'pkglineflag    pkglineflag    blueprint = PinCommands(cmds, path=config_path,pin_type=\"mpu6050\").register(blueprint)pkglineflag    if blueprint:   pkglineflag        LOG.debug('The new MPU6050 pin named \"{}\" successfully saved:\\n{}'.format(blueprint[\"--name\"],blueprint))pkglineflag    del blueprintpkglineflagpkglineflagpkglineflagdef delete(cmds):pkglineflag    try: pkglineflag        founded = PinCommands(cmds,path=config_path,pin_type=\"mpu6050\",pin_name=cmds[2]).delete()pkglineflag        if founded == False and cmds[2] == \"all\":pkglineflag            LOG.debug('All MPU6050 pins successfully deleted.')pkglineflag        elif founded:pkglineflag            LOG.debug('The MPU6050 pin named \"{}\" successfully deleted.'.format(cmds[2]))pkglineflag        else:pkglineflag            MPU6050Usage.error_undefined_pin(cmds[2])pkglineflag    except IndexError:pkglineflag        LOG.error(\"Missing arg(s)\")pkglineflag        MPU6050Usage.delete_usage()pkglineflagpkglineflagpkglineflagdef update(cmds):pkglineflag    try:pkglineflag        PinCommands(cmds,config_path,pin_type=\"mpu6050\",pin_name=cmds[2]).update()pkglineflag        LOG.debug('The MPU6050 pin named \"{}\" successfully updated.'.format(cmds[2]))pkglineflag    except Exception as ex:pkglineflag        LOG.error(ex)pkglineflagpkglineflagpkglineflagdef show(cmds):pkglineflag    PinCommands(cmds,path=config_path,pin_type=\"mpu6050\").show()pkglineflagpkglineflagpkglineflagdef run(cmds):pkglineflag    if not len(cmds)>1:pkglineflag        LOG.error(\"Please enter a command!\")pkglineflag        LOG.info(\"You can use 'mpu6050 help' for available commands!\")pkglineflag        return 'OK!'pkglineflag    if cmds[1][0] == '_':pkglineflag        return 'OK!'pkglineflag    try:pkglineflag        exec(\"{}({})\".format(cmds[1],EngineTemplate.exec_formatter_api(cmds)))pkglineflag    except NameError:pkglineflag        LOG.error(\"There is a problem while running MPU6050 command\")pkglineflag        LOG.error(f'Is the \"{cmds[1]}\" a MPU6050 command?')pkglineflag        LOG.info(\"You can use 'mpu6050 help' for available commands!\")pkglineflag    except Exception as ex:pkglineflag        LOG.error(\"There is a problem while running MPU6050 command!\")pkglineflag        LOG.error(str(ex))pkglineflag        LOG.error(\"You can use 'mpu6050 help' for available commands!\")pkglineflagpkglineflagdef read(cmds):pkglineflag    pin = PinCommands(cmds,path=config_path,pin_type=\"mpu6050\").get_pin(cmds[0],cmds[2])pkglineflag    blueprint = {\"--gyro\":\"\",\"--acceleration\":\"\",\"--temperature\":\"\"}pkglineflag    blueprint = EngineTemplate.parameter_parser(cmds,blueprint)pkglineflag    try:pkglineflag        i2c = SoftI2C(scl=Pin(int(pin[\"--scl\"])), sda=Pin(int(pin[\"--sda\"])))pkglineflag    except Exception as ex:pkglineflag        LOG.error(ex)pkglineflag        return 'Error!'pkglineflag    mpu = accel(i2c)pkglineflag    raw_ints = mpu.get_raw_values()pkglineflag    vals = {}pkglineflag    try:pkglineflag        if not blueprint[\"--gyro\"] == \"\":pkglineflag            gylist = blueprint[\"--gyro\"].split(\",\")pkglineflag            for i in gylist:pkglineflag                if i == \"x\":pkglineflag                    vals[\"GyX\"] = mpu.bytes_toint(raw_ints[8], raw_ints[9])pkglineflag                elif i == \"y\":pkglineflag                    vals[\"GyY\"] = mpu.bytes_toint(raw_ints[10], raw_ints[11])pkglineflag                elif i == \"z\":pkglineflag                    vals[\"GyZ\"] = mpu.bytes_toint(raw_ints[12], raw_ints[13])pkglineflag    except Exception as ex:pkglineflag        LOG.error(ex)pkglineflag        return 'Error!'pkglineflag    try:pkglineflag        if not blueprint[\"--acceleration\"] == \"\":pkglineflag            accellist = blueprint[\"--acceleration\"].split(\",\")pkglineflag            for i in accellist:pkglineflag                if i == \"x\":pkglineflag                    vals[\"AcX\"] = mpu.bytes_toint(raw_ints[0], raw_ints[1])pkglineflag                elif i == \"y\":pkglineflag                    vals[\"AcY\"] = mpu.bytes_toint(raw_ints[2], raw_ints[3])pkglineflag                elif i == \"z\":pkglineflag                    vals[\"AcZ\"] = mpu.bytes_toint(raw_ints[4], raw_ints[5])pkglineflag    except Exception as ex:pkglineflag        LOG.error(ex)pkglineflag        return 'Error!'pkglineflag    try:pkglineflag        if blueprint[\"--temperature\"] == \"on\":pkglineflag            vals[\"Tmp\"] = mpu.bytes_toint(raw_ints[6], raw_ints[7]) / 340.00 + 36.53pkglineflag    except Exception as ex:pkglineflag        LOG.error(ex)pkglineflag        return 'Error!'pkglineflag    print(vals)pkglineflag    return valspkglineflagpkglineflagdef listen(cmds):pkglineflag    global cmds2pkglineflag    if not len(cmds) > 2:pkglineflag        LOG.error(\"Please enter pin name!\")pkglineflag        return 'Error!'pkglineflag    blueprint={\"--delay\":\"1\",\"--file\":\"\",\"--loop\":\"-1\"}pkglineflag    listen_conf=EngineTemplate.parameter_parser(cmds,blueprint)pkglineflag    thread_conf={'delay':listen_conf['--delay'],'loop':listen_conf['--loop'],'type':'mpu6050_listen','pin_name':cmds[2]}pkglineflag    del blueprintpkglineflag    pkglineflag    pin = PinCommands(cmds,path=config_path,pin_type=\"mpu6050\").get_pin(cmds[0],cmds[2])pkglineflag    try:pkglineflag        _gooz_start_function_thread(_mpu6050_listen_thread,(pin,listen_conf),thread_conf)pkglineflag    except Exception as ex:pkglineflag        LOG.error(ex)pkglineflag        raise expkglineflag    cmds2 = ['mpu6050','read']pkglineflag    cmds2 += cmds[2:]pkglineflag    del listen_confpkglineflag    del thread_confpkglineflag    pkglineflagdef _mpu6050_listen_thread(pin,conf):pkglineflag    try:pkglineflag        vals = read(cmds2)pkglineflag    except Exception as ex:pkglineflag        LOG.error(ex)pkglineflag        return 'Error!'pkglineflag    try:pkglineflag        if conf[\"--file\"] != \"\":pkglineflag            f = open(conf[\"--file\"],\"a\")pkglineflag            f.write(\"SCL Pin:{}, SDA Pin:{}, Pin Name:{}, Measurement:{}    {}\\n\".format(pin[\"--scl\"],pin[\"--sda\"],pin[\"--name\"],vals,RTC().datetime()))pkglineflag            f.close()pkglineflag    except Exception as ex:pkglineflag        LOG.error(ex)pkglineflag        return 'Error!'pkglineflag"
        },
        {
            "filename": "mpu6050.py",
            "code": "from machine import Pin,SoftI2Cpkglineflagpkglineflagclass accel():pkglineflag    def __init__(self, i2c, addr=0x68):pkglineflag        self.iic = i2cpkglineflag        self.addr = addrpkglineflag        self.iic.start()pkglineflag        self.iic.writeto(self.addr, bytearray([107, 0]))pkglineflag        self.iic.stop()pkglineflagpkglineflag    def get_raw_values(self):pkglineflag        self.iic.start()pkglineflag        a = self.iic.readfrom_mem(self.addr, 0x3B, 14)pkglineflag        self.iic.stop()pkglineflag        return apkglineflagpkglineflag    def bytes_toint(self, firstbyte, secondbyte):pkglineflag        if not firstbyte & 0x80:pkglineflag            return firstbyte << 8 | secondbytepkglineflag        return - (((firstbyte ^ 255) << 8) | (secondbyte ^ 255) + 1)pkglineflag"
        },
        {
            "filename": "mpu6050config.json",
            "code": "[]"
        }
    ]
}